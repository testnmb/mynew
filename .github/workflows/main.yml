name: synczb

on:
  schedule:
    - cron: '0 0/1 * * *'  # æ¯å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch:
  push:
    paths:
      - 'main.py'
      - '.github/workflows/main.yml'

permissions:
  contents: write

jobs:
  fetch_and_process:
    runs-on: ubuntu-latest
    
    steps:
    # 1. æ£€å‡ºé¡¹ç›®ä»“åº“
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 2. è®¾ç½® Python ç¯å¢ƒ
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    # 3. å®‰è£…ä¾èµ–
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    # 4. è¿è¡Œ Python è„šæœ¬
    - name: Run processing script
      run: |
        python main.py

    # 5. é…ç½® Git
    - name: Configure Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    # 6. å¼ºåˆ¶æäº¤æ›´æ”¹
    - name: Commit and Push changes
      run: |
        echo "å¼€å§‹å¼ºåˆ¶æäº¤æ›´æ–°..."
        
        # æ·»åŠ my1.txtæ–‡ä»¶
        git add my1.txt
        
        # åˆ›å»ºæäº¤ä¿¡æ¯
        commit_msg="ğŸ“º æ›´æ–°IPTVæºæ–‡ä»¶ [$(date +'%Y-%m-%d %H:%M')]
        
        æ›´æ–°my1.txtæ–‡ä»¶
        ç”±GitHub Actionsè‡ªåŠ¨æ‰§è¡Œ"
        
        # å¼ºåˆ¶æäº¤
        git commit -m "$commit_msg" || echo "æäº¤å®Œæˆ"
        
        # æ¨é€åˆ°ä»“åº“
        git push origin main
        
        echo "âœ… æ–‡ä»¶å·²å¼ºåˆ¶æ›´æ–°"

    # 7. ä¸Šä¼ å·¥ä»¶
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: iptv-files
        path: my1.txt
        retention-days: 7
